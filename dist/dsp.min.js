(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){function ADSR(attackLength,decayLength,sustainLevel,sustainLength,releaseLength,sampleRate){this.sampleRate=sampleRate;this.attackLength=attackLength;this.decayLength=decayLength;this.sustainLevel=sustainLevel;this.sustainLength=sustainLength;this.releaseLength=releaseLength;this.sampleRate=sampleRate;this.attackSamples=attackLength*sampleRate;this.decaySamples=decayLength*sampleRate;this.sustainSamples=sustainLength*sampleRate;this.releaseSamples=releaseLength*sampleRate;this.update=function(){this.attack=this.attackSamples;this.decay=this.attack+this.decaySamples;this.sustain=this.decay+this.sustainSamples;this.release=this.sustain+this.releaseSamples};this.update();this.samplesProcessed=0}ADSR.prototype.noteOn=function(){this.samplesProcessed=0;this.sustainSamples=this.sustainLength*this.sampleRate;this.update()};ADSR.prototype.noteOff=function(){this.sustainSamples=this.samplesProcessed-this.decaySamples;this.update()};ADSR.prototype.processSample=function(sample){var amplitude=0;if(this.samplesProcessed<=this.attack){amplitude=0+(1-0)*((this.samplesProcessed-0)/(this.attack-0))}else if(this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay){amplitude=1+(this.sustainLevel-1)*((this.samplesProcessed-this.attack)/(this.decay-this.attack))}else if(this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain){amplitude=this.sustainLevel}else if(this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release){amplitude=this.sustainLevel+(0-this.sustainLevel)*((this.samplesProcessed-this.sustain)/(this.release-this.sustain))}return sample*amplitude};ADSR.prototype.value=function(){var amplitude=0;if(this.samplesProcessed<=this.attack){amplitude=0+(1-0)*((this.samplesProcessed-0)/(this.attack-0))}else if(this.samplesProcessed>this.attack&&this.samplesProcessed<=this.decay){amplitude=1+(this.sustainLevel-1)*((this.samplesProcessed-this.attack)/(this.decay-this.attack))}else if(this.samplesProcessed>this.decay&&this.samplesProcessed<=this.sustain){amplitude=this.sustainLevel}else if(this.samplesProcessed>this.sustain&&this.samplesProcessed<=this.release){amplitude=this.sustainLevel+(0-this.sustainLevel)*((this.samplesProcessed-this.sustain)/(this.release-this.sustain))}return amplitude};ADSR.prototype.process=function(buffer){for(var i=0;i<buffer.length;i++){buffer[i]*=this.value();this.samplesProcessed++}return buffer};ADSR.prototype.isActive=function(){if(this.samplesProcessed>this.release||this.samplesProcessed===-1){return false}else{return true}};ADSR.prototype.disable=function(){this.samplesProcessed=-1};module.exports=ADSR},{}],2:[function(require,module,exports){var DSP=require("./dsp");var sinh=require("./sinh");function Biquad(type,sampleRate){this.Fs=sampleRate;this.type=type;this.parameterType=DSP.Q;this.x_1_l=0;this.x_2_l=0;this.y_1_l=0;this.y_2_l=0;this.x_1_r=0;this.x_2_r=0;this.y_1_r=0;this.y_2_r=0;this.b0=1;this.a0=1;this.b1=0;this.a1=0;this.b2=0;this.a2=0;this.b0a0=this.b0/this.a0;this.b1a0=this.b1/this.a0;this.b2a0=this.b2/this.a0;this.a1a0=this.a1/this.a0;this.a2a0=this.a2/this.a0;this.f0=3e3;this.dBgain=12;this.Q=1;this.BW=-3;this.S=1;this.coefficients=function(){var b=[this.b0,this.b1,this.b2];var a=[this.a0,this.a1,this.a2];return{b:b,a:a}};this.setFilterType=function(type){this.type=type;this.recalculateCoefficients()};this.setSampleRate=function(rate){this.Fs=rate;this.recalculateCoefficients()};this.setQ=function(q){this.parameterType=DSP.Q;this.Q=Math.max(Math.min(q,115),.001);this.recalculateCoefficients()};this.setBW=function(bw){this.parameterType=DSP.BW;this.BW=bw;this.recalculateCoefficients()};this.setS=function(s){this.parameterType=DSP.S;this.S=Math.max(Math.min(s,5),1e-4);this.recalculateCoefficients()};this.setF0=function(freq){this.f0=freq;this.recalculateCoefficients()};this.setDbGain=function(g){this.dBgain=g;this.recalculateCoefficients()};this.recalculateCoefficients=function(){var A;if(type===DSP.PEAKING_EQ||type===DSP.LOW_SHELF||type===DSP.HIGH_SHELF){A=Math.pow(10,this.dBgain/40)}else{A=Math.sqrt(Math.pow(10,this.dBgain/20))}var w0=DSP.TWO_PI*this.f0/this.Fs;var cosw0=Math.cos(w0);var sinw0=Math.sin(w0);var alpha=0;switch(this.parameterType){case DSP.Q:alpha=sinw0/(2*this.Q);break;case DSP.BW:alpha=sinw0*sinh(Math.LN2/2*this.BW*w0/sinw0);break;case DSP.S:alpha=sinw0/2*Math.sqrt((A+1/A)*(1/this.S-1)+2);break}var coeff;switch(this.type){case DSP.LPF:this.b0=(1-cosw0)/2;this.b1=1-cosw0;this.b2=(1-cosw0)/2;this.a0=1+alpha;this.a1=-2*cosw0;this.a2=1-alpha;break;case DSP.HPF:this.b0=(1+cosw0)/2;this.b1=-(1+cosw0);this.b2=(1+cosw0)/2;this.a0=1+alpha;this.a1=-2*cosw0;this.a2=1-alpha;break;case DSP.BPF_CONSTANT_SKIRT:this.b0=sinw0/2;this.b1=0;this.b2=-sinw0/2;this.a0=1+alpha;this.a1=-2*cosw0;this.a2=1-alpha;break;case DSP.BPF_CONSTANT_PEAK:this.b0=alpha;this.b1=0;this.b2=-alpha;this.a0=1+alpha;this.a1=-2*cosw0;this.a2=1-alpha;break;case DSP.NOTCH:this.b0=1;this.b1=-2*cosw0;this.b2=1;this.a0=1+alpha;this.a1=-2*cosw0;this.a2=1-alpha;break;case DSP.APF:this.b0=1-alpha;this.b1=-2*cosw0;this.b2=1+alpha;this.a0=1+alpha;this.a1=-2*cosw0;this.a2=1-alpha;break;case DSP.PEAKING_EQ:this.b0=1+alpha*A;this.b1=-2*cosw0;this.b2=1-alpha*A;this.a0=1+alpha/A;this.a1=-2*cosw0;this.a2=1-alpha/A;break;case DSP.LOW_SHELF:coeff=sinw0*Math.sqrt((A^2+1)*(1/this.S-1)+2*A);this.b0=A*(A+1-(A-1)*cosw0+coeff);this.b1=2*A*(A-1-(A+1)*cosw0);this.b2=A*(A+1-(A-1)*cosw0-coeff);this.a0=A+1+(A-1)*cosw0+coeff;this.a1=-2*(A-1+(A+1)*cosw0);this.a2=A+1+(A-1)*cosw0-coeff;break;case DSP.HIGH_SHELF:coeff=sinw0*Math.sqrt((A^2+1)*(1/this.S-1)+2*A);this.b0=A*(A+1+(A-1)*cosw0+coeff);this.b1=-2*A*(A-1+(A+1)*cosw0);this.b2=A*(A+1+(A-1)*cosw0-coeff);this.a0=A+1-(A-1)*cosw0+coeff;this.a1=2*(A-1-(A+1)*cosw0);this.a2=A+1-(A-1)*cosw0-coeff;break}this.b0a0=this.b0/this.a0;this.b1a0=this.b1/this.a0;this.b2a0=this.b2/this.a0;this.a1a0=this.a1/this.a0;this.a2a0=this.a2/this.a0};this.process=function(buffer){var len=buffer.length;var output=new Float64Array(len);for(var i=0;i<buffer.length;i++){output[i]=this.b0a0*buffer[i]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l;this.y_2_l=this.y_1_l;this.y_1_l=output[i];this.x_2_l=this.x_1_l;this.x_1_l=buffer[i]}return output};this.processStereo=function(buffer){var len=buffer.length;var output=new Float64Array(len);for(var i=0;i<len/2;i++){output[2*i]=this.b0a0*buffer[2*i]+this.b1a0*this.x_1_l+this.b2a0*this.x_2_l-this.a1a0*this.y_1_l-this.a2a0*this.y_2_l;this.y_2_l=this.y_1_l;this.y_1_l=output[2*i];this.x_2_l=this.x_1_l;this.x_1_l=buffer[2*i];output[2*i+1]=this.b0a0*buffer[2*i+1]+this.b1a0*this.x_1_r+this.b2a0*this.x_2_r-this.a1a0*this.y_1_r-this.a2a0*this.y_2_r;this.y_2_r=this.y_1_r;this.y_1_r=output[2*i+1];this.x_2_r=this.x_1_r;this.x_1_r=buffer[2*i+1]}return output}}module.exports=Biquad},{"./dsp":4,"./sinh":17}],3:[function(require,module,exports){var FourierTransform=require("./fourier");function DFT(bufferSize,sampleRate){FourierTransform.call(this,bufferSize,sampleRate);var N=bufferSize/2*bufferSize;var TWO_PI=2*Math.PI;this.sinTable=new Float64Array(N);this.cosTable=new Float64Array(N);for(var i=0;i<N;i++){this.sinTable[i]=Math.sin(i*TWO_PI/bufferSize);this.cosTable[i]=Math.cos(i*TWO_PI/bufferSize)}}DFT.prototype.forward=function(buffer){var real=this.real,imag=this.imag,rval,ival;for(var k=0;k<this.bufferSize/2;k++){rval=0;ival=0;for(var n=0;n<buffer.length;n++){rval+=this.cosTable[k*n]*buffer[n];ival+=this.sinTable[k*n]*buffer[n]}real[k]=rval;imag[k]=ival}return this.calculateSpectrum()};module.exports=DFT},{"./fourier":6}],4:[function(require,module,exports){var DSP={LEFT:0,RIGHT:1,MIX:2,SINE:1,TRIANGLE:2,SAW:3,SQUARE:4,LOWPASS:0,HIGHPASS:1,BANDPASS:2,NOTCH:3,BARTLETT:1,BARTLETTHANN:2,BLACKMAN:3,COSINE:4,GAUSS:5,HAMMING:6,HANN:7,LANCZOS:8,RECTANGULAR:9,TRIANGULAR:10,OFF:0,FW:1,BW:2,FWBW:3,TWO_PI:2*Math.PI};function setupTypedArray(name,fallback){if(typeof this[name]!=="function"&&typeof this[name]!=="object"){if(typeof this[fallback]==="function"&&typeof this[fallback]!=="object"){this[name]=this[fallback]}else{this[name]=function(obj){if(obj instanceof Array){return obj}else if(typeof obj==="number"){return new Array(obj)}}}}}setupTypedArray("Float64Array","WebGLFloatArray");setupTypedArray("Int32Array","WebGLIntArray");setupTypedArray("Uint16Array","WebGLUnsignedShortArray");setupTypedArray("Uint8Array","WebGLUnsignedByteArray");DSP.invert=function(buffer){for(var i=0,len=buffer.length;i<len;i++){buffer[i]*=-1}return buffer};DSP.interleave=function(left,right){if(left.length!==right.length){throw"Can not interleave. Channel lengths differ."}var stereoInterleaved=new Float64Array(left.length*2);for(var i=0,len=left.length;i<len;i++){stereoInterleaved[2*i]=left[i];stereoInterleaved[2*i+1]=right[i]}return stereoInterleaved};DSP.deinterleave=function(){var left,right,mix,deinterleaveChannel=[];deinterleaveChannel[DSP.MIX]=function(buffer){for(var i=0,len=buffer.length/2;i<len;i++){mix[i]=(buffer[2*i]+buffer[2*i+1])/2}return mix};deinterleaveChannel[DSP.LEFT]=function(buffer){for(var i=0,len=buffer.length/2;i<len;i++){left[i]=buffer[2*i]}return left};deinterleaveChannel[DSP.RIGHT]=function(buffer){for(var i=0,len=buffer.length/2;i<len;i++){right[i]=buffer[2*i+1]}return right};return function(channel,buffer){left=left||new Float64Array(buffer.length/2);right=right||new Float64Array(buffer.length/2);mix=mix||new Float64Array(buffer.length/2);if(buffer.length/2!==left.length){left=new Float64Array(buffer.length/2);right=new Float64Array(buffer.length/2);mix=new Float64Array(buffer.length/2)}return deinterleaveChannel[channel](buffer)}}();DSP.getChannel=DSP.deinterleave;DSP.mixSampleBuffers=function(sampleBuffer1,sampleBuffer2,negate,volumeCorrection){var outputSamples=new Float64Array(sampleBuffer1);for(var i=0;i<sampleBuffer1.length;i++){outputSamples[i]+=(negate?-sampleBuffer2[i]:sampleBuffer2[i])/volumeCorrection}return outputSamples};DSP.LPF=0;DSP.HPF=1;DSP.BPF_CONSTANT_SKIRT=2;DSP.BPF_CONSTANT_PEAK=3;DSP.NOTCH=4;DSP.APF=5;DSP.PEAKING_EQ=6;DSP.LOW_SHELF=7;DSP.HIGH_SHELF=8;DSP.Q=1;DSP.BW=2;DSP.S=3;DSP.RMS=function(buffer){var total=0;for(var i=0,n=buffer.length;i<n;i++){total+=buffer[i]*buffer[i]}return Math.sqrt(total/n)};DSP.Peak=function(buffer){var peak=0;for(var i=0,n=buffer.length;i<n;i++){peak=Math.abs(buffer[i])>peak?Math.abs(buffer[i]):peak}return peak};DSP.mag2db=function(buffer){var minDb=-120;var minMag=Math.pow(10,minDb/20);var log=Math.log;var max=Math.max;var result=new Float64Array(buffer.length);for(var i=0;i<buffer.length;i++){result[i]=20*log(max(buffer[i],minMag))}return result};DSP.freqz=function(b,a,w){var i,j;if(!w){w=new Float64Array(200);for(i=0;i<w.length;i++){w[i]=DSP.TWO_PI/w.length*i-Math.PI}}var result=new Float64Array(w.length);var sqrt=Math.sqrt;var cos=Math.cos;var sin=Math.sin;for(i=0;i<w.length;i++){var numerator={real:0,imag:0};for(j=0;j<b.length;j++){numerator.real+=b[j]*cos(-j*w[i]);numerator.imag+=b[j]*sin(-j*w[i])}var denominator={real:0,imag:0};for(j=0;j<a.length;j++){denominator.real+=a[j]*cos(-j*w[i]);denominator.imag+=a[j]*sin(-j*w[i])}result[i]=sqrt(numerator.real*numerator.real+numerator.imag*numerator.imag)/sqrt(denominator.real*denominator.real+denominator.imag*denominator.imag)}return result};module.exports=DSP},{}],5:[function(require,module,exports){var FourierTransform=require("./fourier");function FFT(bufferSize,sampleRate){FourierTransform.call(this,bufferSize,sampleRate);this.reverseTable=new Uint32Array(bufferSize);var limit=1;var bit=bufferSize>>1;var i;while(limit<bufferSize){for(i=0;i<limit;i++){this.reverseTable[i+limit]=this.reverseTable[i]+bit}limit=limit<<1;bit=bit>>1}this.sinTable=new Float64Array(bufferSize);this.cosTable=new Float64Array(bufferSize);for(i=0;i<bufferSize;i++){this.sinTable[i]=Math.sin(-Math.PI/i);this.cosTable[i]=Math.cos(-Math.PI/i)}}FFT.prototype.forward=function(buffer){var bufferSize=this.bufferSize,cosTable=this.cosTable,sinTable=this.sinTable,reverseTable=this.reverseTable,real=this.real,imag=this.imag;var k=Math.floor(Math.log(bufferSize)/Math.LN2);if(Math.pow(2,k)!==bufferSize){throw"Invalid buffer size, must be a power of 2."}if(bufferSize!==buffer.length){throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+bufferSize+" Buffer Size: "+buffer.length}var halfSize=1,phaseShiftStepReal,phaseShiftStepImag,currentPhaseShiftReal,currentPhaseShiftImag,off,tr,ti,tmpReal,i;for(i=0;i<bufferSize;i++){real[i]=buffer[reverseTable[i]];imag[i]=0}while(halfSize<bufferSize){phaseShiftStepReal=cosTable[halfSize];phaseShiftStepImag=sinTable[halfSize];currentPhaseShiftReal=1;currentPhaseShiftImag=0;for(var fftStep=0;fftStep<halfSize;fftStep++){i=fftStep;while(i<bufferSize){off=i+halfSize;tr=currentPhaseShiftReal*real[off]-currentPhaseShiftImag*imag[off];ti=currentPhaseShiftReal*imag[off]+currentPhaseShiftImag*real[off];real[off]=real[i]-tr;imag[off]=imag[i]-ti;real[i]+=tr;imag[i]+=ti;i+=halfSize<<1}tmpReal=currentPhaseShiftReal;currentPhaseShiftReal=tmpReal*phaseShiftStepReal-currentPhaseShiftImag*phaseShiftStepImag;currentPhaseShiftImag=tmpReal*phaseShiftStepImag+currentPhaseShiftImag*phaseShiftStepReal}halfSize=halfSize<<1}return this.calculateSpectrum()};FFT.prototype.inverse=function(real,imag){var bufferSize=this.bufferSize,cosTable=this.cosTable,sinTable=this.sinTable,reverseTable=this.reverseTable;real=real||this.real;imag=imag||this.imag;var halfSize=1,phaseShiftStepReal,phaseShiftStepImag,currentPhaseShiftReal,currentPhaseShiftImag,off,tr,ti,tmpReal,i;for(i=0;i<bufferSize;i++){imag[i]*=-1}var revReal=new Float64Array(bufferSize);var revImag=new Float64Array(bufferSize);for(i=0;i<real.length;i++){revReal[i]=real[reverseTable[i]];revImag[i]=imag[reverseTable[i]]}real=revReal;imag=revImag;while(halfSize<bufferSize){phaseShiftStepReal=cosTable[halfSize];phaseShiftStepImag=sinTable[halfSize];currentPhaseShiftReal=1;currentPhaseShiftImag=0;for(var fftStep=0;fftStep<halfSize;fftStep++){i=fftStep;while(i<bufferSize){off=i+halfSize;tr=currentPhaseShiftReal*real[off]-currentPhaseShiftImag*imag[off];ti=currentPhaseShiftReal*imag[off]+currentPhaseShiftImag*real[off];real[off]=real[i]-tr;imag[off]=imag[i]-ti;real[i]+=tr;imag[i]+=ti;i+=halfSize<<1}tmpReal=currentPhaseShiftReal;currentPhaseShiftReal=tmpReal*phaseShiftStepReal-currentPhaseShiftImag*phaseShiftStepImag;currentPhaseShiftImag=tmpReal*phaseShiftStepImag+currentPhaseShiftImag*phaseShiftStepReal}halfSize=halfSize<<1}var buffer=new Float64Array(bufferSize);for(i=0;i<bufferSize;i++){buffer[i]=real[i]/bufferSize}return buffer};module.exports=FFT},{"./fourier":6}],6:[function(require,module,exports){module.exports=function FourierTransform(bufferSize,sampleRate){this.bufferSize=bufferSize;this.sampleRate=sampleRate;this.bandwidth=2/bufferSize*sampleRate/2;this.spectrum=new Float64Array(bufferSize/2);this.real=new Float64Array(bufferSize);this.imag=new Float64Array(bufferSize);this.peakBand=0;this.peak=0;this.getBandFrequency=function(index){return this.bandwidth*index+this.bandwidth/2};this.calculateSpectrum=function(){var spectrum=this.spectrum,real=this.real,imag=this.imag,bSi=2/this.bufferSize,sqrt=Math.sqrt,rval,ival,mag;for(var i=0,N=bufferSize/2;i<N;i++){rval=real[i];ival=imag[i];mag=bSi*sqrt(rval*rval+ival*ival);if(mag>this.peak){this.peakBand=i;this.peak=mag}spectrum[i]=mag}}}},{}],7:[function(require,module,exports){var DSP=require("./dsp");var Biquad=require("./biquad");function GraphicalEq(sampleRate){this.FS=sampleRate;this.minFreq=40;this.maxFreq=16e3;this.bandsPerOctave=1;this.filters=[];this.freqzs=[];this.calculateFreqzs=true;this.recalculateFilters=function(){var bandCount=Math.round(Math.log(this.maxFreq/this.minFreq)*this.bandsPerOctave/Math.LN2);this.filters=[];for(var i=0;i<bandCount;i++){var freq=this.minFreq*Math.pow(2,i/this.bandsPerOctave);var newFilter=new Biquad(DSP.PEAKING_EQ,this.FS);newFilter.setDbGain(0);newFilter.setBW(1/this.bandsPerOctave);newFilter.setF0(freq);this.filters[i]=newFilter;this.recalculateFreqz(i)}};this.setMinimumFrequency=function(freq){this.minFreq=freq;this.recalculateFilters()};this.setMaximumFrequency=function(freq){this.maxFreq=freq;this.recalculateFilters()};this.setBandsPerOctave=function(bands){this.bandsPerOctave=bands;this.recalculateFilters()};this.setBandGain=function(bandIndex,gain){if(bandIndex<0||bandIndex>this.filters.length-1){throw"The band index of the graphical equalizer is out of bounds."}if(!gain){throw"A gain must be passed."}this.filters[bandIndex].setDbGain(gain);this.recalculateFreqz(bandIndex)};this.recalculateFreqz=function(bandIndex){if(!this.calculateFreqzs){return}if(bandIndex<0||bandIndex>this.filters.length-1){throw"The band index of the graphical equalizer is out of bounds. "+bandIndex+" is out of ["+0+", "+this.filters.length-1+"]"}if(!this.w){this.w=new Float64Array(400);for(var i=0;i<this.w.length;i++){this.w[i]=Math.PI/this.w.length*i}}var b=[this.filters[bandIndex].b0,this.filters[bandIndex].b1,this.filters[bandIndex].b2];var a=[this.filters[bandIndex].a0,this.filters[bandIndex].a1,this.filters[bandIndex].a2];this.freqzs[bandIndex]=DSP.mag2db(DSP.freqz(b,a,this.w))};this.process=function(buffer){var output=buffer;for(var i=0;i<this.filters.length;i++){output=this.filters[i].process(output)}return output};this.processStereo=function(buffer){var output=buffer;for(var i=0;i<this.filters.length;i++){output=this.filters[i].processStereo(output)}return output}}module.exports=GraphicalEq},{"./biquad":2,"./dsp":4}],8:[function(require,module,exports){var DSP=require("./dsp");var ADSR=require("./adsr");function IIRFilter(type,cutoff,resonance,sampleRate){this.sampleRate=sampleRate;switch(type){case DSP.LOWPASS:case DSP.LP12:this.func=new IIRFilter.LP12(cutoff,resonance,sampleRate);break}}IIRFilter.prototype.__defineGetter__("cutoff",function(){return this.func.cutoff});IIRFilter.prototype.__defineGetter__("resonance",function(){return this.func.resonance});IIRFilter.prototype.set=function(cutoff,resonance){this.func.calcCoeff(cutoff,resonance)};IIRFilter.prototype.process=function(buffer){this.func.process(buffer)};IIRFilter.prototype.addEnvelope=function(envelope){if(envelope instanceof ADSR){this.func.addEnvelope(envelope)}else{throw"Not an envelope."}};IIRFilter.LP12=function(cutoff,resonance,sampleRate){this.sampleRate=sampleRate;this.vibraPos=0;this.vibraSpeed=0;this.envelope=false;this.calcCoeff=function(cutoff,resonance){this.w=2*Math.PI*cutoff/this.sampleRate;this.q=1-this.w/(2*(resonance+.5/(1+this.w))+this.w-2);this.r=this.q*this.q;this.c=this.r+1-2*Math.cos(this.w)*this.q;this.cutoff=cutoff;this.resonance=resonance};this.calcCoeff(cutoff,resonance);this.process=function(buffer){for(var i=0;i<buffer.length;i++){this.vibraSpeed+=(buffer[i]-this.vibraPos)*this.c;this.vibraPos+=this.vibraSpeed;this.vibraSpeed*=this.r;if(this.envelope){buffer[i]=buffer[i]*(1-this.envelope.value())+this.vibraPos*this.envelope.value();this.envelope.samplesProcessed++}else{buffer[i]=this.vibraPos}}}};IIRFilter.LP12.prototype.addEnvelope=function(envelope){this.envelope=envelope};module.exports=IIRFilter},{"./adsr":1,"./dsp":4}],9:[function(require,module,exports){var ADSR=require("./adsr");function IIRFilter2(type,cutoff,resonance,sampleRate){this.type=type;this.cutoff=cutoff;this.resonance=resonance;this.sampleRate=sampleRate;this.f=new Float64Array(4);this.f[0]=0;this.f[1]=0;this.f[2]=0;this.f[3]=0;this.calcCoeff=function(cutoff,resonance){this.freq=2*Math.sin(Math.PI*Math.min(.25,cutoff/(this.sampleRate*2)));this.damp=Math.min(2*(1-Math.pow(resonance,.25)),Math.min(2,2/this.freq-this.freq*.5))};this.calcCoeff(cutoff,resonance)}IIRFilter2.prototype.process=function(buffer){var input,output;var f=this.f;for(var i=0;i<buffer.length;i++){input=buffer[i];f[3]=input-this.damp*f[2];f[0]=f[0]+this.freq*f[2];f[1]=f[3]-f[0];f[2]=this.freq*f[1]+f[2];output=.5*f[this.type];f[3]=input-this.damp*f[2];f[0]=f[0]+this.freq*f[2];f[1]=f[3]-f[0];f[2]=this.freq*f[1]+f[2];output+=.5*f[this.type];if(this.envelope){buffer[i]=buffer[i]*(1-this.envelope.value())+output*this.envelope.value();this.envelope.samplesProcessed++}else{buffer[i]=output}}};IIRFilter2.prototype.addEnvelope=function(envelope){if(envelope instanceof ADSR){this.envelope=envelope}else{throw"This is not an envelope."}};IIRFilter2.prototype.set=function(cutoff,resonance){this.calcCoeff(cutoff,resonance)};module.exports=IIRFilter2},{"./adsr":1}],10:[function(require,module,exports){"use strict";var DSPJS={DSP:require("./dsp"),DFT:require("./dft"),FFT:require("./fft"),RFFT:require("./rfft"),Sampler:require("./sampler"),Oscillator:require("./oscillator"),ADSR:require("./adsr"),IIRFilter:require("./iir-filter"),IIRFilter2:require("./iir-filter2"),WindowFunction:require("./window-function"),sinh:require("./sinh"),Biquad:require("./biquad"),GraphicalEq:require("./graphical-eq"),MultiDelay:require("./multi-delay"),SingleDelay:require("./single-delay"),Reverb:require("./reverb")};if(typeof module==="object"&&module.exports)module.exports=DSPJS;if(typeof window!=="undefined"){Object.keys(DSPJS).forEach(function(k){window[k]=DSPJS[k]})}},{"./adsr":1,"./biquad":2,"./dft":3,"./dsp":4,"./fft":5,"./graphical-eq":7,"./iir-filter":8,"./iir-filter2":9,"./multi-delay":11,"./oscillator":12,"./reverb":13,"./rfft":14,"./sampler":15,"./single-delay":16,"./sinh":17,"./window-function":18}],11:[function(require,module,exports){function MultiDelay(maxDelayInSamplesSize,delayInSamples,masterVolume,delayVolume){this.delayBufferSamples=new Float64Array(maxDelayInSamplesSize);this.delayInputPointer=delayInSamples;this.delayOutputPointer=0;this.delayInSamples=delayInSamples;this.masterVolume=masterVolume;this.delayVolume=delayVolume}MultiDelay.prototype.setDelayInSamples=function(delayInSamples){this.delayInSamples=delayInSamples;this.delayInputPointer=this.delayOutputPointer+delayInSamples;if(this.delayInputPointer>=this.delayBufferSamples.length-1){this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length}};MultiDelay.prototype.setMasterVolume=function(masterVolume){this.masterVolume=masterVolume};MultiDelay.prototype.setDelayVolume=function(delayVolume){this.delayVolume=delayVolume};MultiDelay.prototype.process=function(samples){var outputSamples=new Float64Array(samples.length);for(var i=0;i<samples.length;i++){var delaySample=this.delayBufferSamples[this.delayOutputPointer]===null?0:this.delayBufferSamples[this.delayOutputPointer];var sample=delaySample*this.delayVolume+samples[i];this.delayBufferSamples[this.delayInputPointer]=sample;outputSamples[i]=sample*this.masterVolume;this.delayInputPointer++;if(this.delayInputPointer>=this.delayBufferSamples.length-1){this.delayInputPointer=0}this.delayOutputPointer++;if(this.delayOutputPointer>=this.delayBufferSamples.length-1){this.delayOutputPointer=0}}return outputSamples};module.exports=MultiDelay},{}],12:[function(require,module,exports){var DSP=require("./dsp");function Oscillator(type,frequency,amplitude,bufferSize,sampleRate){this.frequency=frequency;this.amplitude=amplitude;this.bufferSize=bufferSize;this.sampleRate=sampleRate;this.frameCount=0;this.waveTableLength=2048;this.cyclesPerSample=frequency/sampleRate;this.signal=new Float64Array(bufferSize);this.envelope=null;switch(parseInt(type,10)){case DSP.TRIANGLE:this.func=Oscillator.Triangle;break;case DSP.SAW:this.func=Oscillator.Saw;break;case DSP.SQUARE:this.func=Oscillator.Square;break;default:case DSP.SINE:this.func=Oscillator.Sine;break}this.generateWaveTable=function(){Oscillator.waveTable[this.func]=new Float64Array(2048);var waveTableTime=this.waveTableLength/this.sampleRate;var waveTableHz=1/waveTableTime;for(var i=0;i<this.waveTableLength;i++){Oscillator.waveTable[this.func][i]=this.func(i*waveTableHz/this.sampleRate)}};if(typeof Oscillator.waveTable==="undefined"){Oscillator.waveTable={}}if(typeof Oscillator.waveTable[this.func]==="undefined"){this.generateWaveTable()}this.waveTable=Oscillator.waveTable[this.func]}Oscillator.prototype.setAmp=function(amplitude){if(amplitude>=0&&amplitude<=1){this.amplitude=amplitude}else{throw"Amplitude out of range (0..1)."}};Oscillator.prototype.setFreq=function(frequency){this.frequency=frequency;this.cyclesPerSample=frequency/this.sampleRate};Oscillator.prototype.add=function(oscillator){for(var i=0;i<this.bufferSize;i++){this.signal[i]+=oscillator.signal[i]}return this.signal};Oscillator.prototype.addSignal=function(signal){for(var i=0;i<signal.length;i++){if(i>=this.bufferSize){break}this.signal[i]+=signal[i]}return this.signal};Oscillator.prototype.addEnvelope=function(envelope){this.envelope=envelope};Oscillator.prototype.applyEnvelope=function(){this.envelope.process(this.signal)};Oscillator.prototype.valueAt=function(offset){return this.waveTable[offset%this.waveTableLength]};Oscillator.prototype.generate=function(){var frameOffset=this.frameCount*this.bufferSize;var step=this.waveTableLength*this.frequency/this.sampleRate;var offset;for(var i=0;i<this.bufferSize;i++){offset=Math.round((frameOffset+i)*step);this.signal[i]=this.waveTable[offset%this.waveTableLength]*this.amplitude}this.frameCount++;return this.signal};Oscillator.Sine=function(step){return Math.sin(DSP.TWO_PI*step)};Oscillator.Square=function(step){return step<.5?1:-1};Oscillator.Saw=function(step){return 2*(step-Math.round(step))};Oscillator.Triangle=function(step){return 1-4*Math.abs(Math.round(step)-step)};Oscillator.Pulse=function(){};module.exports=Oscillator},{"./dsp":4}],13:[function(require,module,exports){var DSP=require("./dsp");var IIRFilter2=require("./iir-filter2");var SingleDelay=require("./single-delay");var MultiDelay=require("./multi-delay");function Reverb(maxDelayInSamplesSize,delayInSamples,masterVolume,mixVolume,delayVolume,dampFrequency){this.delayInSamples=delayInSamples;this.masterVolume=masterVolume;this.mixVolume=mixVolume;this.delayVolume=delayVolume;this.dampFrequency=dampFrequency;this.NR_OF_MULTIDELAYS=6;this.NR_OF_SINGLEDELAYS=6;this.LOWPASSL=new IIRFilter2(DSP.LOWPASS,dampFrequency,0,44100);this.LOWPASSR=new IIRFilter2(DSP.LOWPASS,dampFrequency,0,44100);this.singleDelays=[];var i,delayMultiply;for(i=0;i<this.NR_OF_SINGLEDELAYS;i++){delayMultiply=1+i/7;this.singleDelays[i]=new SingleDelay(maxDelayInSamplesSize,Math.round(this.delayInSamples*delayMultiply),this.delayVolume)}this.multiDelays=[];for(i=0;i<this.NR_OF_MULTIDELAYS;i++){delayMultiply=1+i/10;this.multiDelays[i]=new MultiDelay(maxDelayInSamplesSize,Math.round(this.delayInSamples*delayMultiply),this.masterVolume,this.delayVolume)}}Reverb.prototype.setDelayInSamples=function(delayInSamples){this.delayInSamples=delayInSamples;var i,delayMultiply;for(i=0;i<this.NR_OF_SINGLEDELAYS;i++){delayMultiply=1+i/7;this.singleDelays[i].setDelayInSamples(Math.round(this.delayInSamples*delayMultiply))}for(i=0;i<this.NR_OF_MULTIDELAYS;i++){delayMultiply=1+i/10;this.multiDelays[i].setDelayInSamples(Math.round(this.delayInSamples*delayMultiply))}};Reverb.prototype.setMasterVolume=function(masterVolume){this.masterVolume=masterVolume};Reverb.prototype.setMixVolume=function(mixVolume){this.mixVolume=mixVolume};Reverb.prototype.setDelayVolume=function(delayVolume){this.delayVolume=delayVolume;var i;for(i=0;i<this.NR_OF_SINGLEDELAYS;i++){this.singleDelays[i].setDelayVolume(this.delayVolume)}for(i=0;i<this.NR_OF_MULTIDELAYS;i++){this.multiDelays[i].setDelayVolume(this.delayVolume)}};Reverb.prototype.setDampFrequency=function(dampFrequency){this.dampFrequency=dampFrequency;this.LOWPASSL.set(dampFrequency,0);this.LOWPASSR.set(dampFrequency,0)};Reverb.prototype.process=function(interleavedSamples){var outputSamples=new Float64Array(interleavedSamples.length);var leftRightMix=DSP.deinterleave(interleavedSamples);this.LOWPASSL.process(leftRightMix[DSP.LEFT]);this.LOWPASSR.process(leftRightMix[DSP.RIGHT]);var filteredSamples=DSP.interleave(leftRightMix[DSP.LEFT],leftRightMix[DSP.RIGHT]);var i;for(i=0;i<this.NR_OF_MULTIDELAYS;i++){outputSamples=DSP.mixSampleBuffers(outputSamples,this.multiDelays[i].process(filteredSamples),2%i===0,this.NR_OF_MULTIDELAYS)}var singleDelaySamples=new Float64Array(outputSamples.length);for(i=0;i<this.NR_OF_SINGLEDELAYS;i++){singleDelaySamples=DSP.mixSampleBuffers(singleDelaySamples,this.singleDelays[i].process(outputSamples),2%i===0,1)}for(i=0;i<singleDelaySamples.length;i++){singleDelaySamples[i]*=this.mixVolume}outputSamples=DSP.mixSampleBuffers(singleDelaySamples,interleavedSamples,0,1);for(i=0;i<outputSamples.length;i++){outputSamples[i]*=this.masterVolume}return outputSamples};module.exports=Reverb},{"./dsp":4,"./iir-filter2":9,"./multi-delay":11,"./single-delay":16}],14:[function(require,module,exports){var FourierTransform=require("./fourier");function RFFT(bufferSize,sampleRate){FourierTransform.call(this,bufferSize,sampleRate);this.trans=new Float64Array(bufferSize);this.reverseTable=new Uint32Array(bufferSize);this.reverseBinPermute=function(dest,source){var bufferSize=this.bufferSize,halfSize=bufferSize>>>1,nm1=bufferSize-1,i=1,r=0,h;dest[0]=source[0];do{r+=halfSize;dest[i]=source[r];dest[r]=source[i];i++;h=halfSize<<1;while(h=h>>1,!((r^=h)&h));if(r>=i){dest[i]=source[r];dest[r]=source[i];dest[nm1-i]=source[nm1-r];dest[nm1-r]=source[nm1-i]}i++}while(i<halfSize);dest[nm1]=source[nm1]};this.generateReverseTable=function(){var bufferSize=this.bufferSize,halfSize=bufferSize>>>1,nm1=bufferSize-1,i=1,r=0,h;this.reverseTable[0]=0;do{r+=halfSize;this.reverseTable[i]=r;this.reverseTable[r]=i;i++;h=halfSize<<1;while(h=h>>1,!((r^=h)&h));if(r>=i){this.reverseTable[i]=r;this.reverseTable[r]=i;this.reverseTable[nm1-i]=nm1-r;this.reverseTable[nm1-r]=nm1-i}i++}while(i<halfSize);this.reverseTable[nm1]=nm1};this.generateReverseTable()}RFFT.prototype.forward=function(buffer){var n=this.bufferSize,spectrum=this.spectrum,x=this.trans,TWO_PI=2*Math.PI,sqrt=Math.sqrt,i=n>>>1,bSi=2/n,n2,n4,n8,nn,t1,t2,t3,t4,i1,i2,i3,i4,i5,i6,i7,i8,st1,cc1,ss1,cc3,ss3,e,a,rval,ival,mag;this.reverseBinPermute(x,buffer);for(var ix=0,id=4;ix<n;id*=4){for(var i0=ix;i0<n;i0+=id){st1=x[i0]-x[i0+1];x[i0]+=x[i0+1];x[i0+1]=st1}ix=2*(id-1)}n2=2;nn=n>>>1;while(nn=nn>>>1){ix=0;n2=n2<<1;id=n2<<1;n4=n2>>>2;n8=n2>>>3;do{if(n4!==1){for(i0=ix;i0<n;i0+=id){i1=i0;i2=i1+n4;i3=i2+n4;i4=i3+n4;t1=x[i3]+x[i4];x[i4]-=x[i3];x[i3]=x[i1]-t1;x[i1]+=t1;i1+=n8;i2+=n8;i3+=n8;i4+=n8;t1=x[i3]+x[i4];t2=x[i3]-x[i4];t1=-t1*Math.SQRT1_2;t2*=Math.SQRT1_2;st1=x[i2];x[i4]=t1+st1;x[i3]=t1-st1;x[i2]=x[i1]-t2;x[i1]+=t2}}else{for(i0=ix;i0<n;i0+=id){i1=i0;i2=i1+n4;i3=i2+n4;i4=i3+n4;t1=x[i3]+x[i4];x[i4]-=x[i3];x[i3]=x[i1]-t1;x[i1]+=t1}}ix=(id<<1)-n2;id=id<<2}while(ix<n);e=TWO_PI/n2;for(var j=1;j<n8;j++){a=j*e;ss1=Math.sin(a);cc1=Math.cos(a);cc3=4*cc1*(cc1*cc1-.75);ss3=4*ss1*(.75-ss1*ss1);ix=0;id=n2<<1;do{for(i0=ix;i0<n;i0+=id){i1=i0+j;i2=i1+n4;i3=i2+n4;i4=i3+n4;i5=i0+n4-j;i6=i5+n4;i7=i6+n4;i8=i7+n4;t2=x[i7]*cc1-x[i3]*ss1;t1=x[i7]*ss1+x[i3]*cc1;t4=x[i8]*cc3-x[i4]*ss3;t3=x[i8]*ss3+x[i4]*cc3;st1=t2-t4;t2+=t4;t4=st1;x[i8]=t2+x[i6];x[i3]=t2-x[i6];st1=t3-t1;t1+=t3;t3=st1;x[i4]=t3+x[i2];x[i7]=t3-x[i2];x[i6]=x[i1]-t1;x[i1]+=t1;x[i2]=t4+x[i5];x[i5]-=t4}ix=(id<<1)-n2;id=id<<2}while(ix<n)}}while(--i){rval=x[i];ival=x[n-i-1];mag=bSi*sqrt(rval*rval+ival*ival);if(mag>this.peak){this.peakBand=i;this.peak=mag}spectrum[i]=mag}spectrum[0]=bSi*x[0];return spectrum};module.exports=RFFT},{"./fourier":6}],15:[function(require,module,exports){var DSP=require("./dsp");function Sampler(file,bufferSize,sampleRate,playStart,playEnd,loopStart,loopEnd,loopMode){this.file=file;this.bufferSize=bufferSize;this.sampleRate=sampleRate;this.playStart=playStart||0;this.playEnd=playEnd||1;

this.loopStart=loopStart||0;this.loopEnd=loopEnd||1;this.loopMode=loopMode||DSP.OFF;this.loaded=false;this.samples=[];this.signal=new Float64Array(bufferSize);this.frameCount=0;this.envelope=null;this.amplitude=1;this.rootFrequency=110;this.frequency=550;this.step=this.frequency/this.rootFrequency;this.duration=0;this.samplesProcessed=0;this.playhead=0;var audio=document.createElement("AUDIO");var self=this;this.loadSamples=function(event){var buffer=DSP.getChannel(DSP.MIX,event.frameBuffer);for(var i=0;i<buffer.length;i++){self.samples.push(buffer[i])}};this.loadComplete=function(){self.samples=new Float64Array(self.samples);self.loaded=true};this.loadMetaData=function(){self.duration=audio.duration};audio.addEventListener("MozAudioAvailable",this.loadSamples,false);audio.addEventListener("loadedmetadata",this.loadMetaData,false);audio.addEventListener("ended",this.loadComplete,false);audio.muted=true;audio.src=file;audio.play()}Sampler.prototype.applyEnvelope=function(){this.envelope.process(this.signal);return this.signal};Sampler.prototype.generate=function(){var loopWidth=this.playEnd*this.samples.length-this.playStart*this.samples.length;var playStartSamples=this.playStart*this.samples.length;var playEndSamples=this.playEnd*this.samples.length;for(var i=0;i<this.bufferSize;i++){switch(this.loopMode){case DSP.OFF:this.playhead=Math.round(this.samplesProcessed*this.step+playStartSamples);if(this.playhead<this.playEnd*this.samples.length){this.signal[i]=this.samples[this.playhead]*this.amplitude}else{this.signal[i]=0}break;case DSP.FW:this.playhead=Math.round(this.samplesProcessed*this.step%loopWidth+playStartSamples);if(this.playhead<this.playEnd*this.samples.length){this.signal[i]=this.samples[this.playhead]*this.amplitude}break;case DSP.BW:this.playhead=playEndSamples-Math.round(this.samplesProcessed*this.step%loopWidth);if(this.playhead<this.playEnd*this.samples.length){this.signal[i]=this.samples[this.playhead]*this.amplitude}break;case DSP.FWBW:if(Math.floor(this.samplesProcessed*this.step/loopWidth)%2===0){this.playhead=Math.round(this.samplesProcessed*this.step%loopWidth+playStartSamples)}else{this.playhead=playEndSamples-Math.round(this.samplesProcessed*this.step%loopWidth)}if(this.playhead<this.playEnd*this.samples.length){this.signal[i]=this.samples[this.playhead]*this.amplitude}break}this.samplesProcessed++}this.frameCount++;return this.signal};Sampler.prototype.setFreq=function(frequency){var totalProcessed=this.samplesProcessed*this.step;this.frequency=frequency;this.step=this.frequency/this.rootFrequency;this.samplesProcessed=Math.round(totalProcessed/this.step)};Sampler.prototype.reset=function(){this.samplesProcessed=0;this.playhead=0};module.exports=Sampler},{"./dsp":4}],16:[function(require,module,exports){function SingleDelay(maxDelayInSamplesSize,delayInSamples,delayVolume){this.delayBufferSamples=new Float64Array(maxDelayInSamplesSize);this.delayInputPointer=delayInSamples;this.delayOutputPointer=0;this.delayInSamples=delayInSamples;this.delayVolume=delayVolume}SingleDelay.prototype.setDelayInSamples=function(delayInSamples){this.delayInSamples=delayInSamples;this.delayInputPointer=this.delayOutputPointer+delayInSamples;if(this.delayInputPointer>=this.delayBufferSamples.length-1){this.delayInputPointer=this.delayInputPointer-this.delayBufferSamples.length}};SingleDelay.prototype.setDelayVolume=function(delayVolume){this.delayVolume=delayVolume};SingleDelay.prototype.process=function(samples){var outputSamples=new Float64Array(samples.length);for(var i=0;i<samples.length;i++){this.delayBufferSamples[this.delayInputPointer]=samples[i];var delaySample=this.delayBufferSamples[this.delayOutputPointer];outputSamples[i]=delaySample*this.delayVolume;this.delayInputPointer++;if(this.delayInputPointer>=this.delayBufferSamples.length-1){this.delayInputPointer=0}this.delayOutputPointer++;if(this.delayOutputPointer>=this.delayBufferSamples.length-1){this.delayOutputPointer=0}}return outputSamples};module.exports=SingleDelay},{}],17:[function(require,module,exports){function sinh(arg){return(Math.exp(arg)-Math.exp(-arg))/2}module.exports=sinh},{}],18:[function(require,module,exports){var DSP=require("./dsp");function WindowFunction(type,alpha){this.alpha=alpha;switch(type){case DSP.BARTLETT:this.func=WindowFunction.Bartlett;break;case DSP.BARTLETTHANN:this.func=WindowFunction.BartlettHann;break;case DSP.BLACKMAN:this.func=WindowFunction.Blackman;this.alpha=this.alpha||.16;break;case DSP.COSINE:this.func=WindowFunction.Cosine;break;case DSP.GAUSS:this.func=WindowFunction.Gauss;this.alpha=this.alpha||.25;break;case DSP.HAMMING:this.func=WindowFunction.Hamming;break;case DSP.HANN:this.func=WindowFunction.Hann;break;case DSP.LANCZOS:this.func=WindowFunction.Lanczoz;break;case DSP.RECTANGULAR:this.func=WindowFunction.Rectangular;break;case DSP.TRIANGULAR:this.func=WindowFunction.Triangular;break}}WindowFunction.prototype.process=function(buffer){var length=buffer.length;for(var i=0;i<length;i++){buffer[i]*=this.func(length,i,this.alpha)}return buffer};WindowFunction.Bartlett=function(length,index){return 2/(length-1)*((length-1)/2-Math.abs(index-(length-1)/2))};WindowFunction.BartlettHann=function(length,index){return.62-.48*Math.abs(index/(length-1)-.5)-.38*Math.cos(DSP.TWO_PI*index/(length-1))};WindowFunction.Blackman=function(length,index,alpha){var a0=(1-alpha)/2;var a1=.5;var a2=alpha/2;return a0-a1*Math.cos(DSP.TWO_PI*index/(length-1))+a2*Math.cos(4*Math.PI*index/(length-1))};WindowFunction.Cosine=function(length,index){return Math.cos(Math.PI*index/(length-1)-Math.PI/2)};WindowFunction.Gauss=function(length,index,alpha){return Math.pow(Math.E,-.5*Math.pow((index-(length-1)/2)/(alpha*(length-1)/2),2))};WindowFunction.Hamming=function(length,index){return.54-.46*Math.cos(DSP.TWO_PI*index/(length-1))};WindowFunction.Hann=function(length,index){return.5*(1-Math.cos(DSP.TWO_PI*index/(length-1)))};WindowFunction.Lanczos=function(length,index){var x=2*index/(length-1)-1;return Math.sin(Math.PI*x)/(Math.PI*x)};WindowFunction.Rectangular=function(){return 1};WindowFunction.Triangular=function(length,index){return 2/length*(length/2-Math.abs(index-(length-1)/2))};module.exports=WindowFunction},{"./dsp":4}]},{},[10]);